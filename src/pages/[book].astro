---
import Layout from "../layouts/Layout.astro";
import slugify from "slugify";
import bible from "../data/en_kjv.json";
import Chapter from "../components/Chapter.astro";

export async function getStaticPaths() {
	return bible.map((post) => ({
		params: { book: slugify(post.name, { lower: true }) },
		props: { book: post }
	}));
}

const { book } = Astro.props;
---

<Layout title={book.name}>
	<main class='wrapper'>
		<h1>{book.name}</h1>
		{book.chapters.map((chapter, index) => <Chapter chapter={chapter} index={index} />)}
	</main>
</Layout>

<script>
	import Snackbar from "node-snackbar";

	const verses = document.querySelectorAll("p");
	verses.forEach(function (verse) {
		verse.addEventListener("click", function () {
			const url = window.location.href.split("#")[0] + "#" + verse.id;
			navigator.clipboard.writeText(url).then(function () {
				Snackbar.show({
					actionTextColor: "var(--accent)",
					text: "Copied link to verse."
				});
			});
		});
	});
</script>
